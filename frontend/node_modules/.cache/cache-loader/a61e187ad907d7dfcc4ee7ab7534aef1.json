{"remainingRequest":"D:\\kczx\\fGPT\\foundryGPT\\frontend\\node_modules\\babel-loader\\lib\\index.js!D:\\kczx\\fGPT\\foundryGPT\\frontend\\src\\components\\graph\\shape\\items\\anchor-event.js","dependencies":[{"path":"D:\\kczx\\fGPT\\foundryGPT\\frontend\\src\\components\\graph\\shape\\items\\anchor-event.js","mtime":1687233679314},{"path":"D:\\kczx\\fGPT\\foundryGPT\\frontend\\babel.config.js","mtime":1645975640408},{"path":"D:\\kczx\\fGPT\\foundryGPT\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\kczx\\fGPT\\foundryGPT\\frontend\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJEOi9rY3p4L2ZHUFQvZm91bmRyeUdQVC9mcm9udGVuZC9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkuanMiOwp2YXIgZHJhZ0xvZyA9IFtdLAogIGFuY2hvck5vZGVJZCA9IG51bGw7CmV4cG9ydCBkZWZhdWx0IChmdW5jdGlvbiAoYW5jaG9yLCBncm91cCwgcCkgewogIGFuY2hvci5vbignbW91c2VlbnRlcicsIGZ1bmN0aW9uICgpIHsKICAgIGFuY2hvci5hdHRyKHsKICAgICAgY3Vyc29yOiAnY3Jvc3NoYWlyJwogICAgfSk7CiAgfSk7CiAgYW5jaG9yLm9uKCdkcmFnc3RhcnQnLCBmdW5jdGlvbiAoZSkgewogICAgaWYgKGFuY2hvck5vZGVJZCA9PSBudWxsKSB7CiAgICAgIHZhciBfZ3JvdXAkZ2V0Rmlyc3QkYXR0ciA9IGdyb3VwLmdldEZpcnN0KCkuYXR0cigpLAogICAgICAgIHR5cGUgPSBfZ3JvdXAkZ2V0Rmlyc3QkYXR0ci50eXBlLAogICAgICAgIGRpcmVjdGlvbiA9IF9ncm91cCRnZXRGaXJzdCRhdHRyLmRpcmVjdGlvbjsKICAgICAgdmFyIGRpZmYgPSB0eXBlID09PSAndHJpYW5nbGUtbm9kZScgPyBkaXJlY3Rpb24gPT09ICd1cCcgPyAxIDogMCA6IDAuNTsKICAgICAgdmFyIGJCb3ggPSBncm91cC5nZXQoJ2l0ZW0nKS5nZXRCQm94KCk7CiAgICAgIHZhciBpZCA9IGdyb3VwLmdldCgnaXRlbScpLmdldCgnaWQnKTsKICAgICAgdmFyIHBvaW50ID0gW2JCb3gud2lkdGggKiAocFswXSAtIDAuNSksCiAgICAgIC8vIHgKICAgICAgYkJveC5oZWlnaHQgKiAocFsxXSAtIGRpZmYpIC8vIHkKICAgICAgXTsKCiAgICAgIGRyYWdMb2cgPSBbZS54LCBlLnldOwogICAgICB2YXIgbGluZSA9IGdyb3VwLmFkZFNoYXBlKCdwYXRoJywgewogICAgICAgIGF0dHJzOiB7CiAgICAgICAgICBzdHJva2U6ICcjMTg5MEZGJywKICAgICAgICAgIGxpbmVEYXNoOiBbNSwgNV0sCiAgICAgICAgICBwYXRoOiBbWydNJ10uY29uY2F0KHBvaW50KSwgWydMJ10uY29uY2F0KHBvaW50KV0KICAgICAgICB9LAogICAgICAgIGNsYXNzTmFtZTogJ2Rhc2hlZC1saW5lJywKICAgICAgICBwb2ludFN0YXJ0OiBwb2ludAogICAgICB9KTsKICAgICAgZ3JvdXAudG9Gcm9udCgpOwogICAgICBsaW5lLnRvRnJvbnQoKTsKICAgICAgYW5jaG9yTm9kZUlkID0gaWQ7CiAgICB9CiAgfSk7CiAgYW5jaG9yLm9uKCdkcmFnJywgZnVuY3Rpb24gKGUpIHsKICAgIHZhciBfZ3JvdXAkZ2V0Rmlyc3QkYXR0cjIgPSBncm91cC5nZXRGaXJzdCgpLmF0dHIoKSwKICAgICAgdHlwZSA9IF9ncm91cCRnZXRGaXJzdCRhdHRyMi50eXBlLAogICAgICBkaXJlY3Rpb24gPSBfZ3JvdXAkZ2V0Rmlyc3QkYXR0cjIuZGlyZWN0aW9uOwogICAgdmFyIGNhbnZhc0JveCA9IGdyb3VwLmdldCgnY2hpbGRyZW4nKVswXS5nZXQoJ2NhbnZhc0JCb3gnKTsKICAgIGlmICghY2FudmFzQm94KSByZXR1cm47CiAgICB2YXIgZGlmZiA9IHR5cGUgPT09ICd0cmlhbmdsZS1ub2RlJyA/IGRpcmVjdGlvbiA9PT0gJ3VwJyA/IGNhbnZhc0JveC5oZWlnaHQgOiAwIDogY2FudmFzQm94LmhlaWdodCAvIDI7CiAgICB2YXIgbGluZSA9IGdyb3VwLiRnZXRJdGVtKCdkYXNoZWQtbGluZScpOwogICAgdmFyIHBvaW50U3RhcnQgPSBsaW5lLmdldCgncG9pbnRTdGFydCcpOwogICAgdmFyIGVuZFBvaW50ID0gW2UueCAtIGNhbnZhc0JveC54IC0gY2FudmFzQm94LndpZHRoIC8gMiwgZS55IC0gY2FudmFzQm94LnkgLSBkaWZmXTsKICAgIGxpbmUudG9Gcm9udCgpOwogICAgaWYgKE1hdGguc3FydChNYXRoLnBvdyhNYXRoLmFicyhkcmFnTG9nWzBdKSAtIE1hdGguYWJzKGUueCksIDIpICsgTWF0aC5wb3coTWF0aC5hYnMoZHJhZ0xvZ1sxXSkgLSBNYXRoLmFicyhlLnkpLCAyKSkgPj0gMTApIHsKICAgICAgaWYgKGUueCA+PSBkcmFnTG9nWzBdKSB7CiAgICAgICAgaWYgKGUueSA+PSBkcmFnTG9nWzFdKSB7CiAgICAgICAgICBlbmRQb2ludFswXSAtPSAxOwogICAgICAgICAgZW5kUG9pbnRbMV0gLT0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZW5kUG9pbnRbMF0gLT0gMTsKICAgICAgICAgIGVuZFBvaW50WzFdIC09IDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChlLnkgPj0gZHJhZ0xvZ1sxXSkgewogICAgICAgICAgZW5kUG9pbnRbMF0gKz0gMTsKICAgICAgICAgIGVuZFBvaW50WzFdICs9IDE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVuZFBvaW50WzBdICs9IDE7CiAgICAgICAgICBlbmRQb2ludFsxXSArPSAxOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGluZS5hdHRyKHsKICAgICAgcGF0aDogW1snTSddLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkocG9pbnRTdGFydCkpLCBbJ0wnLCBlbmRQb2ludFswXSwgZW5kUG9pbnRbMV1dXQogICAgfSk7CiAgfSk7CiAgYW5jaG9yLm9uKCdkcmFnZW5kJywgZnVuY3Rpb24gKGUpIHsKICAgIHZhciBpdGVtID0gZ3JvdXAuJGdldEl0ZW0oJ2Rhc2hlZC1saW5lJyk7CiAgICBpdGVtLnJlbW92ZSgpOwogICAgYW5jaG9yTm9kZUlkID0gbnVsbDsKICB9KTsKICBhbmNob3Iub24oJ2RyYWdlbnRlcicsIGZ1bmN0aW9uIChlKSB7CiAgICBpZiAoZS50YXJnZXQuY2ZnLm5vZGVJZCAhPT0gYW5jaG9yTm9kZUlkKSB7CiAgICAgIHZhciBpbmRleCA9IGUudGFyZ2V0LmNmZy5pbmRleDsKICAgICAgaWYgKGdyb3VwLmdldEFsbEFuY2hvckJnKClbaW5kZXhdKSB7CiAgICAgICAgZ3JvdXAuZ2V0QWxsQW5jaG9yQmcoKVtpbmRleF0uYXR0cignZmlsbE9wYWNpdHknLCAwLjcpOwogICAgICB9CiAgICB9CiAgfSk7CiAgYW5jaG9yLm9uKCdkcmFnbGVhdmUnLCBmdW5jdGlvbiAoZSkgewogICAgaWYgKGUudGFyZ2V0LmNmZy5ub2RlSWQgIT09IGFuY2hvck5vZGVJZCkgewogICAgICB2YXIgaW5kZXggPSBlLnRhcmdldC5jZmcuaW5kZXg7CiAgICAgIGlmIChncm91cC5nZXRBbGxBbmNob3JCZygpW2luZGV4XSkgewogICAgICAgIGdyb3VwLmdldEFsbEFuY2hvckJnKClbaW5kZXhdLmF0dHIoJ2ZpbGxPcGFjaXR5JywgMC41KTsKICAgICAgfQogICAgfQogIH0pOwp9KTs="},{"version":3,"names":["dragLog","anchorNodeId","anchor","group","p","on","attr","cursor","e","_group$getFirst$attr","getFirst","type","direction","diff","bBox","get","getBBox","id","point","width","height","x","y","line","addShape","attrs","stroke","lineDash","path","concat","className","pointStart","toFront","_group$getFirst$attr2","canvasBox","$getItem","endPoint","Math","sqrt","pow","abs","_toConsumableArray","item","remove","target","cfg","nodeId","index","getAllAnchorBg"],"sources":["D:/kczx/fGPT/foundryGPT/frontend/src/components/graph/shape/items/anchor-event.js"],"sourcesContent":["\r\nlet dragLog = [], \r\nanchorNodeId = null; \r\n\r\nexport default (anchor, group, p) => {\r\n\r\n  anchor.on('mouseenter', () => {\r\n\r\n    anchor.attr({\r\n      cursor: 'crosshair',\r\n    });\r\n  });\r\n\r\n  anchor.on('dragstart', e => {\r\n    if (anchorNodeId == null) {\r\n      const { type, direction } = group.getFirst().attr();\r\n      const diff = type === 'triangle-node' ? (direction === 'up' ? 1 : 0) : 0.5;\r\n      const bBox = group.get('item').getBBox();\r\n      const id = group.get('item').get('id');\r\n      const point = [\r\n        bBox.width * (p[0] - 0.5), // x\r\n        bBox.height * (p[1] - diff), // y\r\n      ];\r\n\r\n      dragLog = [e.x, e.y];\r\n\r\n      const line = group.addShape('path', {\r\n        attrs: {\r\n          stroke:   '#1890FF',\r\n          lineDash: [5, 5],\r\n          path:     [\r\n            ['M', ...point],\r\n            ['L', ...point],\r\n          ],\r\n        },\r\n        className:  'dashed-line',\r\n        pointStart: point,\r\n      });\r\n\r\n\r\n      group.toFront();\r\n      line.toFront();\r\n      anchorNodeId = id;\r\n    }\r\n  });\r\n\r\n\r\n  anchor.on('drag', e => {\r\n    const { type, direction } = group.getFirst().attr();\r\n    const canvasBox = group.get('children')[0].get('canvasBBox');\r\n\r\n    if (!canvasBox) return;\r\n\r\n    const diff = type === 'triangle-node' ? (direction === 'up' ? canvasBox.height : 0) : canvasBox.height / 2;\r\n    const line = group.$getItem('dashed-line');\r\n    const pointStart = line.get('pointStart');\r\n    const endPoint = [e.x - canvasBox.x - canvasBox.width / 2, e.y - canvasBox.y - diff];\r\n\r\n    line.toFront();\r\n\r\n    \r\n    if (Math.sqrt(Math.pow(Math.abs(dragLog[0]) - Math.abs(e.x), 2) + Math.pow(Math.abs(dragLog[1]) - Math.abs(e.y), 2)) >= 10) {\r\n      if (e.x >= dragLog[0]) {\r\n\r\n        if (e.y >= dragLog[1]) {\r\n          endPoint[0] -= 1;\r\n          endPoint[1] -= 1;\r\n        } else {\r\n\r\n          endPoint[0] -= 1;\r\n          endPoint[1] -= 1;\r\n        }\r\n      } else {\r\n\r\n        if (e.y >= dragLog[1]) {\r\n          endPoint[0] += 1;\r\n          endPoint[1] += 1;\r\n        } else {\r\n\r\n          endPoint[0] += 1;\r\n          endPoint[1] += 1;\r\n        }\r\n      }\r\n    }\r\n\r\n    line.attr({\r\n      path: [\r\n        ['M', ...pointStart],\r\n        ['L', endPoint[0], endPoint[1]],\r\n      ],\r\n    });\r\n  });\r\n\r\n\r\n  anchor.on('dragend', e => {\r\n    const item = group.$getItem('dashed-line');\r\n\r\n    item.remove();\r\n    anchorNodeId = null;\r\n  });\r\n\r\n\r\n  anchor.on('dragenter', e => {\r\n\r\n    if (e.target.cfg.nodeId !== anchorNodeId) {\r\n      const { index } = e.target.cfg;\r\n\r\n      if (group.getAllAnchorBg()[index]) {\r\n        group.getAllAnchorBg()[index].attr('fillOpacity', 0.7);\r\n      }\r\n    }\r\n  });\r\n\r\n\r\n  anchor.on('dragleave', e => {\r\n\r\n    if (e.target.cfg.nodeId !== anchorNodeId) {\r\n      const { index } = e.target.cfg;\r\n\r\n      if (group.getAllAnchorBg()[index]) {\r\n        group.getAllAnchorBg()[index].attr('fillOpacity', 0.5);\r\n      }\r\n    }\r\n  });\r\n\r\n\r\n};\r\n"],"mappings":"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"}]}